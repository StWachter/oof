/*!
 * CrossContextsSettings - Manage the settings of different contexts in one place
 * Version: 1.2.7
 * Build date: 2024-03-20
 */
var crosscontextssettings=function(t){crosscontextssettings.superclass.constructor.call(this,t=t||{})};Ext.extend(crosscontextssettings,Ext.Component,{initComponent:function(){this.stores={},this.ajax=new Ext.data.Connection({disableCaching:!0})},page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{},util:{},form:{}}),Ext.reg("crosscontextssettings",crosscontextssettings),CrossContextsSettings=new crosscontextssettings,MODx.config.help_url="https://jako.github.io/CrossContextsSettings/usage/",CrossContextsSettings.grid.ContextsSettings=function(i){i=i||{},this.buttonColumnTpl=new Ext.XTemplate('<tpl for="."><tpl if="action_buttons !== null"><ul class="action-buttons"><tpl for="action_buttons"><li><i class="icon {className} icon-{icon}" title="{text}"></i></li></tpl></ul></tpl></tpl>',{compiled:!0}),this.ident="crosscontextssettings-contextssettings-"+Ext.id();var e=this,s=[],o=["key","xtype","namespace","area"],t=(i.contexts&&(s=[{header:_("key"),width:150,sortable:!0,dataIndex:"key",locked:!0,id:"key"},{header:_("namespace"),width:100,sortable:!0,dataIndex:"namespace",locked:!0,hidden:!0,id:"namespace"},{header:_("area"),width:100,sortable:!0,dataIndex:"area",locked:!0,hidden:!0,id:"area"},{renderer:this.buttonColumnRenderer.bind(this),menuDisabled:!0,fixed:!0,locked:!0,width:50}],Ext.each(i.contexts,function(t){s.push({header:t.key,width:200,sortable:!1,dataIndex:t.key,id:t.key,editable:!0,renderer:e.renderDynField.createDelegate(e,[e],!0)}),o.push(t.key)})),new Ext.ux.grid.LockingColumnModel({columns:s,getCellEditor:function(t,e){var e=i.store.getAt(e),s={xtype:"textfield"},e=("object"==typeof e&&(s.xtype=e.get("xtype"),"text-password"===s.xtype&&(s.xtype="textfield",s.inputType="password")),MODx.load(s));return new Ext.grid.GridEditor(e)}}));Ext.apply(i,{id:"crosscontextssettings-grid-settings",url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/contextssettings/getlist",columns:o.toString(),namespace:MODx.request.ns||"core",area:MODx.request.area||""},colModel:t,fields:o,paging:!0,pageSize:10,remoteSort:!0,anchor:"100%",view:new Ext.ux.grid.LockingGridView,autoHeight:!1,save_action:"mgr/contextssettings/updatefromgrid",autosave:!0,showActionsColumn:!1,tbar:[{text:_("create"),cls:"primary-button",handler:this.createSetting},{xtype:"modx-combo-namespace",id:this.ident+"-filter-namespace",emptyText:_("namespace_filter"),width:150,listeners:{select:{fn:this.filterByNamespace,scope:this}}},{xtype:"modx-combo-area",id:this.ident+"-filter-area",emptyText:_("area_filter"),baseParams:{action:"system/settings/getAreas"},width:250,listeners:{select:{fn:this.filterByArea,scope:this}}},"->",{xtype:"textfield",name:"filter_key",id:this.ident+"-filter-key",cls:"x-form-filter",emptyText:_("search_by_key"),listeners:{change:{fn:this.filterByKey,scope:this},render:{fn:function(t){new Ext.KeyMap(t.getEl(),{key:Ext.EventObject.ENTER,fn:this.blur,scope:t})},scope:this}}},{xtype:"button",id:this.ident+"-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}],listeners:{afterrender:function(){this.store.on("load",function(){var t=this.getTopToolbar().getHeight(),e=this.getView().lockedHd.getHeight(),s=this.getView().lockedBody.getHeight(),i=this.getBottomToolbar().getHeight();this.setHeight(t+e+s+i+14)},this)}}}),CrossContextsSettings.grid.ContextsSettings.superclass.constructor.call(this,i)},Ext.extend(CrossContextsSettings.grid.ContextsSettings,MODx.grid.Grid,{getMenu:function(){var t=[];t.push({text:_("update"),handler:this.updateSetting}),t.push("-"),t.push({text:_("remove"),handler:this.removeSetting}),this.addContextMenuItem(t)},createSetting:function(t,e){this.createUpdateSetting(t,e,!1)},updateSetting:function(t,e){this.createUpdateSetting(t,e,!0)},createUpdateSetting:function(t,e,s){var i={};if(s){if(!this.menu.record||!this.menu.record.key)return!1;i=this.menu.record}else i={namespace:Ext.getCmp(this.ident+"-filter-namespace").value||"",area:Ext.getCmp(this.ident+"-filter-area").value||""};s=MODx.load({xtype:"crosscontextssettings-window-contextssetting-create-update",isUpdate:s,title:s?_("update"):_("create"),record:i,contexts:CrossContextsSettings.config.contexts,listeners:{success:{fn:this.refresh,scope:this}}});s.fp.getForm().setValues(i),s.show(e.target)},removeSetting:function(){MODx.msg.confirm({title:_("remove"),text:_("setting_remove_confirm"),url:CrossContextsSettings.config.connectorUrl,params:{action:"mgr/contextssettings/remove",key:this.menu.record.key},listeners:{success:{fn:this.refresh,scope:this}}})},clearFilter:function(){var t=this.getStore();t.baseParams.key="",t.baseParams.namespace="",t.baseParams.area="",Ext.getCmp(this.ident+"-filter-namespace").reset(),Ext.getCmp(this.ident+"-filter-area").reset(),Ext.getCmp(this.ident+"-filter-key").reset(),this.getBottomToolbar().changePage(1),this.refresh()},filterByKey:function(t,e){return this.getStore().baseParams.key=e,this.getStore().baseParams.namespace="",this.getBottomToolbar().changePage(1),this.refresh(),!0},filterByNamespace:function(t,e){this.getStore().baseParams.namespace=e.data.name,this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1),this.refresh();var s,i=Ext.getCmp("crosscontextssettings-filter-area");i&&((s=i.store).baseParams.namespace=e.data.name,s.removeAll(),s.load(),i.setValue(""))},filterByArea:function(t,e){this.getStore().baseParams.area=e.data.v,this.getBottomToolbar().changePage(1),this.refresh()},renderDynField:function(t,e,s,i,o,n,r){var l,d,a=n.getAt(i).data;return t=Ext.util.Format.htmlEncode(t),"combo-boolean"===a.xtype||"modx-combo-boolean"===a.xtype?(0,MODx.grid.Grid.prototype.rendYesNo)(t,e,s,i,o,n,r):"datefield"===a.xtype?function(t){return"string"==typeof t&&""!==t&&Date.parseDate(t,"Y-m-d H:i:s")?(t=Date.parseDate(t,"Y-m-d H:i:s"),Ext.util.Format.date(t,MODx.config.manager_date_format)):t}:"text-password"===a.xtype||"modx-text-password"===a.xtype?(0,MODx.grid.Grid.prototype.rendPassword)(t,e,s,i,o,n,r):"combo"===a.xtype.substr(0,5)||"modx-combo"===a.xtype.substr(0,10)?((d=(l=r.getColumnModel()).getCellEditor(o,i))||(a=Ext.ComponentMgr.create({xtype:a.xtype||"textfield"}),d=new Ext.grid.GridEditor(a),l.setEditor(o,d)),d.store&&!d.store.isLoaded&&"local"!==d.config.mode&&(d.store.load(),d.store.isLoaded=!0),Ext.util.Format.comboRenderer(d.field,t)(t,e,s,i,o,n,r)):t},buttonColumnRenderer:function(t,e){e.css="x-grid-cell-icons";e={action_buttons:[{className:"update",icon:"pencil-square-o",text:_("update")},{className:"remove",icon:"trash-o",text:_("remove")}]};return this.buttonColumnTpl.apply(e)},onClick:function(t){var e=t.getTarget();if("icon"===e.className.split(" ")[0]){var e=e.className.split(" ")[1],s=this.getSelectionModel().getSelected();switch(this.menu.record=s.data,e){case"remove":this.removeSetting(s,t);break;case"update":this.updateSetting(s,t)}}}}),Ext.reg("crosscontextssettings-grid-contextssettings",CrossContextsSettings.grid.ContextsSettings),CrossContextsSettings.window.CreateUpdateContextsSetting=function(e){e=e||{},this.ident="crosscontextssettings-window-contextssettings-create-update-"+Ext.id();var s=[];Ext.each(e.contexts,function(t){s.push({xtype:e.record.xtype||"textarea",fieldLabel:_("value")+" ("+t.key+")",name:t.key,hiddenName:t.key,anchor:"100%"})}),Ext.applyIf(e,{id:this.ident,url:CrossContextsSettings.config.connectorUrl,action:e.isUpdate?"mgr/contextssettings/update":"mgr/contextssettings/create",width:600,autoHeight:!0,closeAction:"close",cls:"modx-window crosscontextssettings-window modx"+CrossContextsSettings.config.modxversion,contexts:Ext.util.JSON.encode(e.contexts),fields:[{layout:"column",items:[{columnWidth:.5,layout:"form",items:[{xtype:"textfield",fieldLabel:_("key"),name:"key",id:this.ident+"-key",maxLength:100,readOnly:e.isUpdate,anchor:"100%"},{xtype:"label",forId:this.ident+"-key",html:_("key_desc"),cls:"desc-under"},{xtype:"modx-combo-namespace",fieldLabel:_("namespace"),name:"namespace",hiddenName:"namespace",id:this.ident+"-namespace",anchor:"100%"},{xtype:"label",forId:this.ident+"-namespace",html:_("namespace_desc"),cls:"desc-under"}]},{columnWidth:.5,layout:"form",items:[{xtype:"modx-combo-xtype-spec",fieldLabel:_("xtype"),name:"xtype",hiddenName:"xtype",description:MODx.expandHelp?"":_("xtype_desc"),id:this.ident+"-xtype",anchor:"100%"},{xtype:"label",forId:this.ident+"-xtype",html:_("xtype_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("area_lexicon_string"),name:"area",id:this.ident+"-area",anchor:"100%"},{xtype:"label",forId:this.ident+"-area",html:_("area_lexicon_string_msg"),cls:"desc-under"}]}]},{layout:"form",labelAlign:"top",anchor:"100%",border:!1,style:"padding-bottom: 15px",items:s}]}),CrossContextsSettings.window.CreateUpdateContextsSetting.superclass.constructor.call(this,e)},Ext.extend(CrossContextsSettings.window.CreateUpdateContextsSetting,MODx.Window),Ext.reg("crosscontextssettings-window-contextssetting-create-update",CrossContextsSettings.window.CreateUpdateContextsSetting),CrossContextsSettings.panel.ClearCache=function(t){t=t||{};var e=[];Ext.each(t.contexts,function(t){""!==t.key&&e.push({xtype:"xcheckbox",id:"crosscontextssettings-clearcache-"+t.key,boxLabel:t.name||t.key,name:"ctxs["+t.key+"]",inputValue:"1"})}),Ext.applyIf(t,{id:"crosscontextssettings-clearcache-panel",bodyStyle:"margin: 10px 10px 0",url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/contexts/clearcache"},buttonAlign:"left",items:[{xtype:"xcheckbox",boxLabel:"All",listeners:{check:{fn:function(e){Ext.each(t.contexts,function(t){t=Ext.getCmp("crosscontextssettings-clearcache-"+t.key);t&&t.setValue(e.getValue())})},scope:this}}},{xtype:"panel",id:"crosscontextssettings-clearcache-contexts",anchor:"100%",items:e}],buttons:[{text:_("clear_cache"),cls:"primary-button",scope:this,handler:function(){this.submit()}}],listeners:{success:{fn:this.success,scope:this}}}),CrossContextsSettings.panel.ClearCache.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.ClearCache,MODx.FormPanel,{success:function(t){this.getForm().reset(),MODx.msg.status({title:_("success"),message:t.result.message||_("refresh_success"),dontHide:!1})}}),Ext.reg("crosscontextssettings-panel-clearcache",CrossContextsSettings.panel.ClearCache),CrossContextsSettings.panel.Home=function(t){t=t||{},Ext.applyIf(t,{cls:"container home-panel"+(CrossContextsSettings.config.debug?" debug":"")+" modx"+CrossContextsSettings.config.modxversion,defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("crosscontextssettings")+"</h2>"+(CrossContextsSettings.config.debug?'<div class="ribbon top-right"><span>'+_("crosscontextssettings.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,cls:"crosscontextssettings-panel",items:[{xtype:"crosscontextssettings-panel-overview"}]},{cls:"treehillstudio_about",html:'<img width="146" height="40" src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft-small.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft-small@2x.png 2x" alt="virtudraft"><span style="line-height: 40px;height: 40px;display: inline-block;vertical-align: top;margin: 0 10px;">+</span><img width="146" height="40" src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio-small.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio-small@2x.png 2x" alt="Treehill Studio">',listeners:{afterrender:function(){this.getEl().select("img").on("click",function(){var t='<span style="display: inline-block; text-align: center"><img src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft@2x.png 2x" alt="virtudraft" style="margin-top: 10px"><br>&copy; 2014-2020 by Virtudraft <a href="https://github.com/virtudraft" target="_blank">github.com/virtudraft</a><br><img src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio@2x.png 2x" alt="Treehill Studio" style="margin-top: 10px"><br>&copy; 2021-2024 by <a href="https://treehillstudio.com" target="_blank">treehillstudio.com</a></span>';Ext.Msg.show({title:_("crosscontextssettings")+" "+CrossContextsSettings.config.version,msg:t,buttons:Ext.Msg.OK,cls:"treehillstudio_window",width:358})})}}}]}),CrossContextsSettings.panel.Home.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Home,MODx.Panel),Ext.reg("crosscontextssettings-panel-home",CrossContextsSettings.panel.Home),CrossContextsSettings.panel.HomeTab=function(t){t=t||{},Ext.applyIf(t,{id:"crosscontextssettings-panel-"+t.tabtype,title:t.title,items:[{html:"<p>"+t.description+"</p>",border:!1,cls:"panel-desc"},{layout:"form",cls:"x-form-label-left main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"crosscontextssettings-panel-"+t.tabtype+"-"+t.contenttype,xtype:"crosscontextssettings-"+t.contenttype+"-"+t.tabtype,preventRender:!0,contexts:CrossContextsSettings.config.contexts}]}]}),CrossContextsSettings.panel.HomeTab.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.HomeTab,MODx.Panel),Ext.reg("crosscontextssettings-panel-hometab",CrossContextsSettings.panel.HomeTab),CrossContextsSettings.panel.Overview=function(t){t=t||{},this.ident="crosscontextssettings-panel-overview-"+Ext.id(),this.panelOverviewTabs=[{xtype:"crosscontextssettings-panel-hometab",title:_("crosscontextssettings.contextssettings"),description:_("crosscontextssettings.contextssettings_desc"),tabtype:"contextssettings",contenttype:"grid"},{xtype:"crosscontextssettings-panel-hometab",title:_("crosscontextssettings.clearcache"),description:_("crosscontextssettings.clearcache_desc"),tabtype:"clearcache",contenttype:"panel"}],CrossContextsSettings.config.is_admin&&this.panelOverviewTabs.push({xtype:"crosscontextssettings-panel-settings"}),Ext.applyIf(t,{id:this.ident,items:[{xtype:"modx-tabs",border:!0,stateful:!0,stateId:"babel-panel-overview",stateEvents:["tabchange"],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())}},autoScroll:!0,deferredRender:!0,forceLayout:!1,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(t,e){"crosscontextssettings-panel-settings"===e.xtype?Ext.getCmp("crosscontextssettings-grid-system-settings")&&Ext.getCmp("crosscontextssettings-grid-system-settings").getStore().reload():"crosscontextssettings-panel-hometab"===e.xtype&&(MODx.request.ns="",MODx.request.area="",Ext.getCmp("crosscontextssettings-grid-settings")&&Ext.getCmp("crosscontextssettings-grid-settings").getStore().reload())}}}]}),CrossContextsSettings.panel.Overview.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Overview,MODx.Panel),Ext.reg("crosscontextssettings-panel-overview",CrossContextsSettings.panel.Overview),MODx.grid.SettingsGrid&&(CrossContextsSettings.panel.Settings=function(t){t=t||{},MODx.request.ns="crosscontextssettings",Ext.applyIf(t,{id:"crosscontextssettings-panel-settings",title:_("crosscontextssettings.settings"),items:[{html:"<p>"+_("crosscontextssettings.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"crosscontextssettings-grid-system-settings",id:"crosscontextssettings-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),CrossContextsSettings.panel.Settings.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Settings,MODx.Panel),Ext.reg("crosscontextssettings-panel-settings",CrossContextsSettings.panel.Settings),CrossContextsSettings.grid.SystemSettings=function(t){t=t||{},Ext.applyIf(t,{id:"crosscontextssettings-grid-systemsettings",url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/settings/getlist",area:MODx.request.area||""},save_action:"mgr/settings/updatefromgrid",tbar:[],queryParam:3<=CrossContextsSettings.config.modxversion?"query":"key"}),CrossContextsSettings.grid.SystemSettings.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(t,e,s){s.stopEvent(),s.preventDefault(),this.menu.record=this.getStore().getAt(e).data,this.getSelectionModel().isSelected(e)||this.getSelectionModel().selectRow(e),this.menu.removeAll();e=[];this.menu.record.menu?e=this.menu.record.menu:e.push({text:_("setting_update")||_("edit"),handler:this.updateSetting}),0<e.length&&(this.addContextMenuItem(e),this.menu.showAt(s.xy))},updateSetting:function(t,e){var s=this.menu.record,i=(s.fk=Ext.isDefined(this.config.fk)?this.config.fk:0,MODx.load({xtype:"modx-window-setting-update",url:CrossContextsSettings.config.connectorUrl,action:"mgr/settings/update",record:s,grid:this,listeners:{success:{fn:this.refresh,scope:this}}}));i.reset(),i.setValues(s),i.show(e.target)},clearFilter:function(){var t=MODx.request.area||"",e=(this.getStore().baseParams=this.initialConfig.baseParams,Ext.getCmp("modx-filter-area")),e=((e=e||this.topToolbar.getComponent("filter-area"))&&(e.store.load(),e.reset()),Ext.getCmp("modx-filter-"+this.config.queryParam));(e=e||this.topToolbar.getComponent("filter-query"))&&e.reset(),this.getStore().baseParams.area=t,this.getStore().baseParams[this.config.queryParam]="",this.getBottomToolbar().changePage(1)},filterByKey:function(t,e){return this.getStore().baseParams[this.config.queryParam]=e,this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var t,e=Ext.getCmp("modx-filter-area");(e=e||this.topToolbar.getComponent("filter-area"))&&((t=e.store).removeAll(),t.load(),e.setValue(""))},listeners:{afterrender:function(t){var e=Ext.getCmp("modx-filter-namespace");(e=e||t.topToolbar.getComponent("filter-ns"))&&e.hide()}}}),Ext.reg("crosscontextssettings-grid-system-settings",CrossContextsSettings.grid.SystemSettings)),Ext.ns("Ext.ux.grid"),Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:!1,initTemplates:function(){var t=this.templates||{};t.masterTpl||(t.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")),this.templates=t,Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(t){return this.el.dom},initElements:function(){var t=Ext.get(this.grid.getGridEl().dom.firstChild),e=t.child("div.x-grid3-locked"),s=e.child("div.x-grid3-header"),i=e.child("div.x-grid3-scroller"),o=t.child("div.x-grid3-viewport"),n=o.child("div.x-grid3-header"),r=o.child("div.x-grid3-scroller");this.grid.hideHeaders&&(s.setDisplayed(!1),n.setDisplayed(!1)),this.forceFit&&r.setStyle("overflow-x","hidden"),Ext.apply(this,{el:t,mainWrap:o,mainHd:n,innerHd:n.dom.firstChild,scroller:r,mainBody:r.child("div.x-grid3-body"),focusEl:r.child("a"),resizeMarker:t.child("div.x-grid3-resize-marker"),resizeProxy:t.child("div.x-grid3-resize-proxy"),lockedWrap:e,lockedHd:s,lockedScroller:i,lockedBody:i.child("div.x-grid3-body"),lockedInnerHd:s.child("div.x-grid3-header-inner",!0)}),this.focusEl.swallowEvent("click",!0)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(t){return this.getLockedRows()[t]},getCell:function(t,e){var s=this.cm.getLockedCount();return e<s?this.getLockedRow(t).getElementsByTagName("td")[e]:Ext.ux.grid.LockingGridView.superclass.getCell.call(this,t,e-s)},getHeaderCell:function(t){var e=this.cm.getLockedCount();return t<e?this.lockedHd.dom.getElementsByTagName("td")[t]:Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,t-e)},addRowClass:function(t,e){var s=this.getLockedRow(t);s&&this.fly(s).addClass(e),Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,t,e)},removeRowClass:function(t,e){var s=this.getLockedRow(t);s&&this.fly(s).removeClass(e),Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,t,e)},removeRow:function(t){Ext.removeNode(this.getLockedRow(t)),Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,t)},removeRows:function(t,e){for(var s=this.lockedBody.dom,i=t;i<=e;i++)Ext.removeNode(s.childNodes[t]);Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,t,e)},syncScroll:function(t){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop,Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,t)},updateSortIcon:function(t,e){var s=this.sortClasses,i=this.lockedHd.select("td").removeClass(s),o=this.mainHd.select("td").removeClass(s),n=this.cm.getLockedCount(),s=s["DESC"==e?1:0];(t<n?i.item(t):o.item(t-n)).addClass(s)},updateAllColumnWidths:function(){var t=this.getTotalWidth(),e=this.cm.getColumnCount(),s=this.getLockedWidth(),i=this.cm.getLockedCount(),o=[];for(this.updateLockedWidth(),a=0;a<e;a++)o[a]=this.getColumnWidth(a),this.getHeaderCell(a).style.width=o[a];for(var n,r,l,c=this.getLockedRows(),d=this.getRows(),a=0,h=d.length;a<h;a++){if((n=c[a]).style.width=s,n.firstChild)for(n.firstChild.style.width=s,r=n.firstChild.rows[0],l=0;l<i;l++)r.childNodes[l].style.width=o[l];if((n=d[a]).style.width=t,n.firstChild)for(n.firstChild.style.width=t,r=n.firstChild.rows[0],l=i;l<e;l++)r.childNodes[l-i].style.width=o[l]}this.onAllColumnWidthsUpdated(o,t),this.syncHeaderHeight()},updateColumnWidth:function(t,a){var e,s,i,o,n=this.getColumnWidth(t),r=this.cm.getLockedCount();this.updateLockedWidth(),i=t<r?(e=this.getLockedRows(),s=this.getLockedWidth(),t):(e=this.getRows(),s=this.getTotalWidth(),t-r),this.getHeaderCell(t).style.width=n;for(var l=0,d=e.length;l<d;l++)(o=e[l]).style.width=s,o.firstChild&&(o.firstChild.style.width=s,o.firstChild.rows[0].childNodes[i].style.width=n);this.onColumnWidthUpdated(t,n,this.getTotalWidth()),this.syncHeaderHeight()},updateColumnHidden:function(t,e){var s,i,o,n,r=this.cm.getLockedCount(),l=e?"none":"";this.updateLockedWidth(),o=t<r?(s=this.getLockedRows(),i=this.getLockedWidth(),t):(s=this.getRows(),i=this.getTotalWidth(),t-r),this.getHeaderCell(t).style.display=l;for(var d=0,a=s.length;d<a;d++)(n=s[d]).style.width=i,n.firstChild&&(n.firstChild.style.width=i,n.firstChild.rows[0].childNodes[o].style.display=l);this.onColumnHiddenUpdated(t,e,this.getTotalWidth()),delete this.lastViewWidth,this.layout()},doRender:function(c,h,g,x,t,m){for(var e,u=this.templates,p=u.cell,f=u.row,y=t-1,C="width:"+this.getTotalWidth()+";",w="width:"+this.getLockedWidth()+";",s=[],i=[],o={},n={},r=0,v=h.length;r<v;r++){for(var l=h[r],k=[],b=[],E=r+x,d=0;d<t;d++)e=c[d],o.id=e.id,o.css=(0===d?"x-grid3-cell-first ":d==y?"x-grid3-cell-last ":"")+(this.cm.config[d].cellCls?" "+this.cm.config[d].cellCls:""),o.attr=o.cellAttr="",o.value=e.renderer(l.data[e.name],o,l,E,d,g),o.style=e.style,Ext.isEmpty(o.value)&&(o.value="&#160;"),this.markDirty&&l.dirty&&Ext.isDefined(l.modified[e.name])&&(o.css+=" x-grid3-dirty-cell"),e.locked?b[b.length]=p.apply(o):k[k.length]=p.apply(o);var a=[];m&&(E+1)%2==0&&(a[0]="x-grid3-row-alt"),l.dirty&&(a[1]=" x-grid3-dirty-row"),n.cols=t,this.getRowClass&&(a[2]=this.getRowClass(l,E,n,g)),n.alt=a.join(" "),n.cells=k.join(""),n.tstyle=C,s[s.length]=f.apply(n),n.cells=b.join(""),n.tstyle=w,i[i.length]=f.apply(n)}return[s.join(""),i.join("")]},processRows:function(t,e){if(this.ds&&!(this.ds.getCount()<1)){var s,i,o=this.getRows(),n=this.getLockedRows();e=e||!this.grid.stripeRows,t=t||0;for(var r=0,l=o.length;r<l;++r)s=o[r],i=n[r],s.rowIndex=r,i.rowIndex=r,e||(s.className=s.className.replace(this.rowClsRe," "),i.className=i.className.replace(this.rowClsRe," "),(r+1)%2==0&&(s.className+=" x-grid3-row-alt",i.className+=" x-grid3-row-alt")),this.syncRowHeights(s,i);0===t&&(Ext.fly(o[0]).addClass(this.firstRowCls),Ext.fly(n[0]).addClass(this.firstRowCls)),Ext.fly(o[o.length-1]).addClass(this.lastRowCls),Ext.fly(n[n.length-1]).addClass(this.lastRowCls)}},syncRowHeights:function(t,e){var s,i;this.syncHeights&&(t=Ext.get(t),e=Ext.get(e),s=t.getHeight(),(i=e.getHeight())<s?e.setHeight(s):s<i&&t.setHeight(i))},afterRender:function(){var t;this.ds&&this.cm&&(t=this.renderRows()||["&#160;","&#160;"],this.mainBody.dom.innerHTML=t[0],this.lockedBody.dom.innerHTML=t[1],this.processRows(0,!0),!0!==this.deferEmptyText&&this.applyEmptyText(),this.grid.fireEvent("viewready",this.grid))},renderUI:function(){var t=this.templates,e=this.renderHeaders(),s=t.body.apply({rows:"&#160;"});return t.masterTpl.apply({body:s,header:e[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:s,lockedHeader:e[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var t=this.grid;this.initElements(),Ext.fly(this.innerHd).on("click",this.handleHdDown,this),Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this),this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.scroller.on("scroll",this.syncScroll,this),!1!==t.enableColumnResize&&(this.splitZone=new Ext.grid.GridView.SplitDragZone(t,this.mainHd.dom),this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom)),this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))),t.enableColumnMove&&(this.columnDrag=new Ext.grid.GridView.ColumnDragZone(t,this.innerHd),this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd)),this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd)),this.columnDrop=new Ext.grid.HeaderDropZone(t,this.mainHd.dom)),!1!==t.enableHdMenu&&(this.hmenu=new Ext.menu.Menu({id:t.id+"-hctx"}),this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),!1!==this.grid.enableColLock&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"}),!1!==t.enableColumnHide&&(this.colMenu=new Ext.menu.Menu({id:t.id+"-hcols-menu"}),this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick}),this.hmenu.add("-",{itemId:"columns",hideOnClick:!1,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})),this.hmenu.on("itemclick",this.handleHdMenuClick,this)),t.trackMouseOver&&(this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut}),this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})),(t.enableDragDrop||t.enableDrag)&&(this.dragZone=new Ext.grid.GridDragZone(t,{ddGroup:t.ddGroup||"GridDD"})),this.updateHeaderSortState()},layout:function(){var t,e,s,i;this.mainBody&&(e=(t=(s=this.grid).getGridEl().getSize(!0)).width,!s.hideHeaders&&(e<20||t.height<20)||(this.syncHeaderHeight(),s.autoHeight?(this.scroller.dom.style.overflow="visible",this.lockedScroller.dom.style.overflow="visible",Ext.isWebKit&&(this.scroller.dom.style.position="static",this.lockedScroller.dom.style.position="static")):(this.el.setSize(t.width,t.height),s=this.mainHd.getHeight(),i=t.height-s),this.updateLockedWidth(),this.forceFit?this.lastViewWidth!=e&&(this.fitColumns(!1,!1),this.lastViewWidth=e):(this.autoExpand(),this.syncHeaderScroll()),this.onLayout(e,i)))},getOffsetWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){for(var t=this.cm,e=this.templates,s=e.hcell,i=[],o=[],n={},r=t.getColumnCount(),l=r-1,d=0;d<r;d++)n.id=t.getColumnId(d),n.value=t.getColumnHeader(d)||"",n.style=this.getColumnStyle(d,!0),n.tooltip=this.getColumnTooltip(d),n.css=(0===d?"x-grid3-cell-first ":d==l?"x-grid3-cell-last ":"")+(t.config[d].headerCls?" "+t.config[d].headerCls:""),"right"==t.config[d].align?n.istyle="padding-right:16px":delete n.istyle,t.isLocked(d)?o[o.length]=s.apply(n):i[i.length]=s.apply(n);return[e.header.apply({cells:i.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),e.header.apply({cells:o.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var t=this.renderHeaders(),t=(this.innerHd.firstChild.innerHTML=t[0],this.innerHd.firstChild.style.width=this.getOffsetWidth(),this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth(),this.lockedInnerHd.firstChild.innerHTML=t[1],this.getLockedWidth());this.lockedInnerHd.firstChild.style.width=t,this.lockedInnerHd.firstChild.firstChild.style.width=t},getResolvedXY:function(t){if(!t)return null;var e=t.cell,t=t.row;return e?Ext.fly(e).getXY():[this.scroller.getX(),Ext.fly(t).getY()]},syncFocusEl:function(t,e,s){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,t,e,!(e<this.cm.getLockedCount())&&s)},ensureVisible:function(t,e,s){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,t,e,!(e<this.cm.getLockedCount())&&s)},insertRows:function(t,e,s,i){var o,n,t=t.getCount()-1;!i&&0===e&&t<=s?this.refresh():(i||this.fireEvent("beforerowsinserted",this,e,s),o=this.renderRows(e,s),(n=this.getRow(e))?(0===e&&this.removeRowClass(0,this.firstRowCls),Ext.DomHelper.insertHtml("beforeBegin",n,o[0]),n=this.getLockedRow(e),Ext.DomHelper.insertHtml("beforeBegin",n,o[1])):(this.removeRowClass(t-1,this.lastRowCls),Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,o[0]),Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,o[1])),i?(0===e||t<=e)&&this.addRowClass(e,0===e?this.firstRowCls:this.lastRowCls):(this.fireEvent("rowsinserted",this,e,s),this.processRows(e))),this.syncFocusEl(e)},getColumnStyle:function(t,e){e=e?this.cm.config[t].headerStyle||"":this.cm.config[t].cellStyle||this.cm.config[t].css||"",e+="width:"+this.getColumnWidth(t)+";",this.cm.isHidden(t)&&(e+="display:none;"),t=this.cm.config[t].align;return t&&(e+="text-align:"+t+";"),e},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var t=[],e=this.cm,s=e.getColumnCount(),i=0;i<s;i++){var o=e.getDataIndex(i);t[i]={name:Ext.isDefined(o)?o:this.ds.fields.get(i).name,renderer:e.getRenderer(i),scope:e.getRendererScope(i),id:e.getColumnId(i),style:this.getColumnStyle(i),locked:e.isLocked(i)}}return t},renderBody:function(){var t=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:t[0]}),this.templates.body.apply({rows:t[1]})]},refreshRow:function(t){var e,s,i,o,n,r,l=this.ds,c=this.cm.getColumnCount(),h=this.getColumnData(),g=c-1,d=["x-grid3-row"],a={tstyle:String.format("width: {0};",this.getTotalWidth())},x={tstyle:String.format("width: {0};",this.getLockedWidth())},m=[],u=[],p=this.templates.cell;if(Ext.isNumber(t)?(e=t,t=l.getAt(e)):e=l.indexOf(t),t&&!(e<0)){for(r=0;r<c;r++)(n={id:(o=h[r]).id,style:o.style,css:0==r?"x-grid3-cell-first":r==g?"x-grid3-cell-last ":"",attr:"",cellAttr:""}).value=o.renderer.call(o.scope,t.data[o.name],n,t,e,r,l),Ext.isEmpty(n.value)&&(n.value=" "),this.markDirty&&t.dirty&&void 0!==t.modified[o.name]&&(n.css+=" x-grid3-dirty-cell"),o.locked?u[r]=p.apply(n):m[r]=p.apply(n);(s=this.getRow(e)).className="",(i=this.getLockedRow(e)).className="",this.grid.stripeRows&&(e+1)%2==0&&d.push("x-grid3-row-alt"),this.getRowClass&&(a.cols=c,d.push(this.getRowClass(t,e,a,l))),this.fly(s).addClass(d).setStyle(a.tstyle),a.cells=m.join(""),s.innerHTML=this.templates.rowInner.apply(a),this.fly(i).addClass(d).setStyle(x.tstyle),x.cells=u.join(""),i.innerHTML=this.templates.rowInner.apply(x),i.rowIndex=e,this.syncRowHeights(s,i),this.fireEvent("rowupdated",this,e,t)}},refresh:function(t){this.fireEvent("beforerefresh",this),this.grid.stopEditing(!0);var e=this.renderBody();this.mainBody.update(e[0]).setWidth(this.getTotalWidth()),this.lockedBody.update(e[1]).setWidth(this.getLockedWidth()),!0===t&&(this.updateHeaders(),this.updateHeaderSortState()),this.processRows(0,!0),this.layout(),this.applyEmptyText(),this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(t,e){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this),Ext.ux.grid.LockingGridView.superclass.initData.call(this,t,e),this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(!0)},handleHdMenuClick:function(t){var e=this.hdCtxIndex,s=this.cm,i=t.getItemId(),o=s.getLockedCount();switch(i){case"lock":if(s.getColumnCount(!0)<=o+1)return void this.onDenyColumnLock();s.setLocked(e,!0,o!=e),o!=e&&(s.moveColumn(e,o),this.grid.fireEvent("columnmove",e,o));break;case"unlock":o-1!=e?(s.setLocked(e,!1,!0),s.moveColumn(e,o-1),this.grid.fireEvent("columnmove",e,o-1)):s.setLocked(e,!1);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,t)}return!0},handleHdDown:function(t,e){var s;Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,t,e),!1!==this.grid.enableColLock&&Ext.fly(e).hasClass("x-grid3-hd-btn")&&(t=this.findHeaderCell(e),e=this.getCellIndex(t),t=this.hmenu.items,s=this.cm,t.get("lock").setDisabled(s.isLocked(e)),t.get("unlock").setDisabled(!s.isLocked(e)))},syncHeaderHeight:function(){var t=Ext.fly(this.innerHd).child("tr",!0),e=Ext.fly(this.lockedInnerHd).child("tr",!0),s=(t.style.height="auto",e.style.height="auto",t.offsetHeight),i=e.offsetHeight,i=Math.max(i,s)+"px";t.style.height=i,e.style.height=i},updateLockedWidth:function(){var t=this.cm.getTotalLockedWidth(),e=this.cm.getTotalWidth()-t,s=this.grid.getGridEl().getSize(!0),i=Ext.isBorderBox?0:this.lockedBorderWidth,o=Ext.isBorderBox?0:this.rowBorderWidth,n=Math.max(s.width-t-i-o,0)+"px",r=this.getScrollOffset();this.grid.autoHeight||(s=Math.max(s.height-this.mainHd.getHeight(),0)+"px",this.lockedScroller.dom.style.height=s,this.scroller.dom.style.height=s),this.lockedWrap.dom.style.width=t+o+"px",this.scroller.dom.style.width=n,this.mainWrap.dom.style.left=t+i+o+"px",this.innerHd&&(this.lockedInnerHd.firstChild.style.width=t+"px",this.lockedInnerHd.firstChild.firstChild.style.width=t+"px",this.innerHd.style.width=n,this.innerHd.firstChild.style.width=e+o+r+"px",this.innerHd.firstChild.firstChild.style.width=e+"px"),this.mainBody&&(this.lockedBody.dom.style.width=t+o+"px",this.mainBody.dom.style.width=e+o+"px")}}),Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(t){return!0===this.config[t].locked},setLocked:function(t,e,s){this.isLocked(t)!=e&&(this.config[t].locked=e,s||this.fireEvent("columnlockchange",this,t,e))},getTotalLockedWidth:function(){for(var t=0,e=0,s=this.config.length;e<s;e++)this.isLocked(e)&&!this.isHidden(e)&&(t+=this.getColumnWidth(e));return t},getLockedCount:function(){for(var t=this.config.length,e=0;e<t;e++)if(!this.isLocked(e))return e;return t},moveColumn:function(t,e){var s=this.isLocked(t),i=this.isLocked(e);t<e&&s&&!i?this.setLocked(t,!1,!0):e<t&&!s&&i&&this.setLocked(t,!0,!0),Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}}),CrossContextsSettings.page.Home=function(t){t=t||{},Ext.applyIf(t,{buttons:[{text:_("help_ex"),handler:MODx.loadHelpPane}],formpanel:"crosscontextssettings-panel-home",components:[{xtype:"crosscontextssettings-panel-home"}]}),CrossContextsSettings.page.Home.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.page.Home,MODx.Component),Ext.reg("crosscontextssettings-page-home",CrossContextsSettings.page.Home);