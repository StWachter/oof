/*!
 * CrossContextsSettings - Manage the settings of different contexts in one place
 * Version: 1.1.1
 * Build date: 2021-03-06
 */

var crosscontextssettings=function(t){return t=t||{},Ext.applyIf(t,{}),crosscontextssettings.superclass.constructor.call(this,t),this};Ext.extend(crosscontextssettings,Ext.Component,{page:{},window:{},grid:{},tree:{},panel:{},combo:{},config:{}}),Ext.reg("crosscontextssettings",crosscontextssettings),CrossContextsSettings=new crosscontextssettings,CrossContextsSettings.grid.ContextSettings=function(i){var e=[],s=[],o=[],n=this;(i=i||{}).record&&(s.push("key"),s.push("xtype"),s.push("namespace"),s.push("area"),e.push({header:_("key"),width:150,sortable:!0,dataIndex:"key",locked:!0,id:"key"}),e.push({header:_("namespace"),width:100,sortable:!0,dataIndex:"namespace",locked:!0,id:"namespace"}),e.push({header:_("area"),width:100,sortable:!0,dataIndex:"area",locked:!0,id:"area",hidden:!0}),Ext.each(i.record,function(t){e.push({header:t.key,width:200,sortable:!1,dataIndex:t.key,id:t.key,editable:!0,renderer:n.renderDynField.createDelegate(n,[n],!0)}),s.push(t.key),o.push(t.key)}));var t=new Ext.ux.grid.LockingColumnModel({columns:e,getCellEditor:function(t,e){var s=i.store.getAt(e),e={xtype:"textfield"};"object"==typeof s&&(e.xtype=s.get("xtype"),"text-password"===e.xtype&&(e.xtype="textfield",e.inputType="password"));e=MODx.load(e);return new Ext.grid.GridEditor(e)}});Ext.applyIf(i,{id:"crosscontextssettings-grid-settings",url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/contextsettings/getlist",columns:s.toString(),namespace:MODx.request.ns||"core",area:MODx.request.area},colModel:t,fields:s,paging:!0,pageSize:10,remoteSort:!0,anchor:"100%",view:new Ext.ux.grid.LockingGridView({syncHeights:!0}),height:595,autoHeight:!1,save_action:"mgr/contextsettings/updatefromgrid",autosave:!0,tbar:[{text:_("setting_create"),scope:this,cls:"primary-button",handler:{xtype:"crosscontextssettings-window-contextsetting-create",blankValues:!0,contexts:o}},{xtype:"modx-combo-namespace",name:"namespace",id:"crosscontextssettings-filter-namespace",emptyText:_("namespace_filter"),allowBlank:!0,width:150,listeners:{select:{fn:this.filterByNamespace,scope:this}}},{xtype:"modx-combo-area",name:"area",id:"crosscontextssettings-filter-area",emptyText:_("area_filter"),baseParams:{action:"system/settings/getAreas"},width:250,allowBlank:!0,listeners:{select:{fn:this.filterByArea,scope:this}}},"->",{xtype:"textfield",name:"filter_key",id:"crosscontextssettings-filter-key",cls:"x-form-filter",emptyText:_("search_by_key")+"...",listeners:{change:{fn:this.filterByKey,scope:this},render:{fn:function(t){new Ext.KeyMap(t.getEl(),{key:Ext.EventObject.ENTER,fn:this.blur,scope:t})},scope:this}}},{xtype:"button",id:"crosscontextssettings-filter-clear",cls:"x-form-filter-clear",text:_("filter_clear"),listeners:{click:{fn:this.clearFilter,scope:this}}}]}),CrossContextsSettings.grid.ContextSettings.superclass.constructor.call(this,i)},Ext.extend(CrossContextsSettings.grid.ContextSettings,MODx.grid.Grid,{getMenu:function(){return[{text:_("remove"),handler:this.removeSetting}]},removeSetting:function(){MODx.msg.confirm({title:_("remove"),text:_("setting_remove_confirm"),url:CrossContextsSettings.config.connectorUrl,params:{action:"mgr/contextsettings/remove",key:this.menu.record.key},listeners:{success:{fn:this.refresh,scope:this}}})},clearFilter:function(){var t=this.getStore();t.baseParams.namespace="",t.baseParams.area="",Ext.getCmp("crosscontextssettings-filter-namespace").reset();t=Ext.getCmp("crosscontextssettings-filter-area");t&&(t.store.baseParams.namespace="",t.store.load(),t.reset()),Ext.getCmp("crosscontextssettings-filter-key").reset(),this.getBottomToolbar().changePage(1),this.refresh()},filterByKey:function(t,e){return this.getStore().baseParams.key=e,this.getStore().baseParams.namespace="",this.getBottomToolbar().changePage(1),this.refresh(),!0},filterByNamespace:function(t,e){this.getStore().baseParams.namespace=e.data.name,this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1),this.refresh();var s,i=Ext.getCmp("crosscontextssettings-filter-area");i&&((s=i.store).baseParams.namespace=e.data.name,s.removeAll(),s.load(),i.setValue(""))},filterByArea:function(t,e){this.getStore().baseParams.area=e.data.v,this.getBottomToolbar().changePage(1),this.refresh()},renderDynField:function(t,e,s,i,o,n,r){var l=n.getAt(i).data;if(t=Ext.util.Format.htmlEncode(t),"combo-boolean"===l.xtype||"modx-combo-boolean"===l.xtype)return(0,MODx.grid.Grid.prototype.rendYesNo)(t,e,s,i,o,n,r);if("datefield"===l.xtype)return Ext.util.Format.dateRenderer(MODx.config.manager_date_format)(t,e,s,i,o,n,r);if("text-password"===l.xtype||"modx-text-password"===l.xtype)return(0,MODx.grid.Grid.prototype.rendPassword)(t,e,s,i,o,n,r);if("combo"!==l.xtype.substr(0,5)&&"modx-combo"!==l.xtype.substr(0,10))return t;var a=r.getColumnModel(),d=a.getCellEditor(o,i);return d||(l=Ext.ComponentMgr.create({xtype:l.xtype||"textfield"}),d=new Ext.grid.GridEditor(l),a.setEditor(o,d)),d.store&&!d.store.isLoaded&&"local"!==d.config.mode&&(d.store.load(),d.store.isLoaded=!0),Ext.util.Format.comboRenderer(d.field,t)(t,e,s,i,o,n,r)}}),Ext.reg("crosscontextssettings-grid-contextsettings",CrossContextsSettings.grid.ContextSettings),CrossContextsSettings.window.CreateContextSetting=function(t){t=t||{};var e=[];Ext.each(t.contexts,function(t){e.push({xtype:"textarea",fieldLabel:_("value")+" ("+t+")",name:"value["+t+"]",anchor:"100%"})}),Ext.applyIf(t,{title:_("setting_create"),width:600,url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/contextsettings/create",contexts:Ext.util.JSON.encode(t.contexts)},fields:[{layout:"column",border:!1,defaults:{layout:"form",labelAlign:"top",anchor:"100%",border:!1},items:[{columnWidth:.5,items:[{xtype:"textfield",fieldLabel:_("key"),name:"key",id:"crosscontextssettings-key",maxLength:100,anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-key",html:_("key_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("name"),name:"name",id:"crosscontextssettings-name",anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-name",html:_("name_desc"),cls:"desc-under"},{xtype:"textarea",fieldLabel:_("description"),name:"description",id:"crosscontextssettings-description",allowBlank:!0,anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-description",html:_("description_desc"),cls:"desc-under"}]},{columnWidth:.5,items:[{xtype:"modx-combo-xtype-spec",fieldLabel:_("xtype"),description:MODx.expandHelp?"":_("xtype_desc"),id:"crosscontextssettings-xtype",anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-xtype",html:_("xtype_desc"),cls:"desc-under"},{xtype:"modx-combo-namespace",fieldLabel:_("namespace"),name:"namespace",id:"crosscontextssettings-namespace",value:"core",anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-namespace",html:_("namespace_desc"),cls:"desc-under"},{xtype:"textfield",fieldLabel:_("area_lexicon_string"),description:_("area_lexicon_string_msg"),name:"area",id:"crosscontextssettings-area",anchor:"100%"},{xtype:"label",forId:"crosscontextssettings-area",html:_("area_lexicon_string_msg"),cls:"desc-under"}]}]},{layout:"form",labelAlign:"top",anchor:"100%",border:!1,style:"padding-bottom: 15px",items:e}],keys:[]}),CrossContextsSettings.window.CreateContextSetting.superclass.constructor.call(this,t),this.on("show",function(){this.reset(),this.setValues({namespace:Ext.getCmp("modx-filter-namespace").value,area:Ext.getCmp("modx-filter-area").value})},this)},Ext.extend(CrossContextsSettings.window.CreateContextSetting,MODx.Window),Ext.reg("crosscontextssettings-window-contextsetting-create",CrossContextsSettings.window.CreateContextSetting),CrossContextsSettings.panel.ClearCache=function(t){t=t||{},Ext.applyIf(t,{id:"crosscontextssettings-clearcache-panel",bodyStyle:"margin: 10px 10px 0",url:CrossContextsSettings.config.connectorUrl,baseParams:{action:"mgr/contexts/clearcache"},buttonAlign:"left",buttons:[{text:_("clear_cache"),cls:"primary-button",scope:this,handler:function(){this.submit()}}],listeners:{setup:{fn:this.setup,scope:this},success:{fn:this.success,scope:this}}}),CrossContextsSettings.panel.ClearCache.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.ClearCache,MODx.FormPanel,{setup:function(){var e,t=this.config.record||{};"object"==typeof t&&(e=this,Ext.each(t,function(t){e.add({xtype:"xcheckbox",boxLabel:t.name||t.key,name:"ctxs["+t.key+"]"})}),e.doLayout(),delete this.config.record)},success:function(t){this.getForm().reset(),MODx.msg.status({title:_("success"),message:t.result.message||_("refresh_success"),dontHide:!1})}}),Ext.reg("crosscontextssettings-clearcache-panel",CrossContextsSettings.panel.ClearCache),CrossContextsSettings.panel.Home=function(t){t=t||{},Ext.applyIf(t,{cls:"container home-panel"+(CrossContextsSettings.config.debug?" debug":""),defaults:{collapsible:!1,autoHeight:!0},items:[{html:"<h2>"+_("crosscontextssettings")+"</h2>"+(CrossContextsSettings.config.debug?'<div class="ribbon top-right"><span>'+_("crosscontextssettings.debug_mode")+"</span></div>":""),border:!1,cls:"modx-page-header"},{defaults:{autoHeight:!0},border:!0,items:[{xtype:"crosscontextssettings-panel-overview"}],cls:"crosscontextssettings-panel"},{cls:"treehillstudio_about",html:'<img width="133" height="40" src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft-small.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft-small@2x.png 2x" alt="virtudraft"><span style="line-height: 40px;height: 40px;display: inline-block;vertical-align: top;margin: 0 10px;">+</span><img width="133" height="40" src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio-small.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio-small@2x.png 2x" alt="Treehill Studio">',listeners:{afterrender:function(t){t.getEl().select("img").on("click",function(){var t='<span style="display: inline-block; text-align: center;"><img src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/virtudraft@2x.png 2x" alt="virtudraft" style="margin-top: 10px"><br>&copy; 2014-2020 by Virtudraft <a href="https://github.com/virtudraft" target="_blank">github.com/virtudraft</a><br><img src="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio.png" srcset="'+CrossContextsSettings.config.assetsUrl+'img/mgr/treehill-studio@2x.png 2x" alt="Treehill Studio" style="margin-top: 10px"><br>&copy; 2021 by <a href="https://treehillstudio.com" target="_blank">treehillstudio.com</a></span>';Ext.Msg.show({title:_("crosscontextssettings")+" "+CrossContextsSettings.config.version,msg:t,buttons:Ext.Msg.OK,cls:"treehillstudio_window",width:330})})}}}]}),CrossContextsSettings.panel.Home.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Home,MODx.Panel),Ext.reg("crosscontextssettings-panel-home",CrossContextsSettings.panel.Home),CrossContextsSettings.panel.HomeTab=function(t){t=t||{},Ext.applyIf(t,{id:"crosscontextssettings-panel-"+t.tabtype,title:t.title,items:[{html:"<p>"+t.description+"</p>",border:!1,cls:"panel-desc"},{cls:"main-wrapper",defaults:{autoHeight:!0},border:!0,items:[{id:"crosscontextssettings-panel-"+t.tabtype+"-holder",preventRender:!0,border:!1,listeners:{afterrender:{fn:function(){this.getContextList(t.callback)},scope:this}}}]}]}),CrossContextsSettings.panel.HomeTab.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.HomeTab,MODx.Panel,{contexts:[],getContextList:function(e){return 0<this.contexts.length?"function"==typeof this[e]?this[e].call(this,this.config):this.contexts:MODx.Ajax.request({url:CrossContextsSettings.config.connectorUrl,params:{action:"mgr/contexts/getlist"},listeners:{success:{fn:function(t){if(t.success&&(this.contexts=t.results,0<this.contexts.length&&"function"==typeof this[e]))return this[e].call(this,this.config)},scope:this}}})},getContextSettingsGrid:function(){this.contexts.length<1||MODx.load({xtype:"crosscontextssettings-grid-contextsettings",record:this.contexts,preventRender:!0,applyTo:"crosscontextssettings-panel-contextsettings-holder"})},getClearCachePanel:function(){var t,e;this.contexts.length<1||(t=new CrossContextsSettings.panel.ClearCache({record:this.contexts,preventRender:!0}),(e=Ext.getCmp("crosscontextssettings-panel-clearcache-holder")).add(t),e.doLayout())}}),Ext.reg("crosscontextssettings-panel-hometab",CrossContextsSettings.panel.HomeTab),CrossContextsSettings.panel.Overview=function(t){t=t||{},this.ident="crosscontextssettings-panel-overview"+Ext.id(),this.panelOverviewTabs=[{xtype:"crosscontextssettings-panel-hometab",title:_("crosscontextssettings.contextsettings"),description:_("crosscontextssettings.contextsettings_desc"),tabtype:"contextsettings",callback:"getContextSettingsGrid"},{xtype:"crosscontextssettings-panel-hometab",title:_("crosscontextssettings.clearcache"),description:_("crosscontextssettings.clearcache_desc"),tabtype:"clearcache",callback:"getClearCachePanel"}],CrossContextsSettings.config.is_admin&&this.panelOverviewTabs.push({xtype:"crosscontextssettings-panel-settings",title:_("crosscontextssettings.settings"),description:_("crosscontextssettings.settings_desc"),tabtype:"settings"}),Ext.applyIf(t,{id:this.ident,items:[{xtype:"modx-tabs",autoScroll:!0,deferredRender:!1,forceLayout:!0,defaults:{layout:"form",autoHeight:!0,hideMode:"offsets"},items:this.panelOverviewTabs,listeners:{tabchange:function(t,e){"systemsettings"===e.tabtype?Ext.getCmp("crosscontextssettings-grid-systemsettings").getStore().reload():"crosscontextssettings-panel-hometab"===e.xtype&&Ext.getCmp("crosscontextssettings-panel-"+e.tabtype+"-grid")&&Ext.getCmp("crosscontextssettings-panel-"+e.tabtype+"-grid").getStore().reload()}}}]}),CrossContextsSettings.panel.Overview.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Overview,MODx.Panel),Ext.reg("crosscontextssettings-panel-overview",CrossContextsSettings.panel.Overview),CrossContextsSettings.panel.Settings=function(t){t=t||{},Ext.applyIf(t,{id:"crosscontextssettings-panel-settings",title:_("crosscontextssettings.settings"),items:[{html:"<p>"+_("crosscontextssettings.settings_desc")+"</p>",border:!1,cls:"panel-desc"},{xtype:"crosscontextssettings-grid-system-settings",id:"crosscontextssettings-grid-system-settings",cls:"main-wrapper",preventSaveRefresh:!0}]}),CrossContextsSettings.panel.Settings.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.panel.Settings,MODx.Panel),Ext.reg("crosscontextssettings-panel-settings",CrossContextsSettings.panel.Settings),CrossContextsSettings.grid.SystemSettings=function(t){(t=t||{}).baseParams={action:"system/settings/getList",namespace:"crosscontextssettings",area:MODx.request.area},t.tbar=[],CrossContextsSettings.grid.SystemSettings.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.grid.SystemSettings,MODx.grid.SettingsGrid,{_showMenu:function(t,e,s){s.stopEvent(),s.preventDefault(),this.menu.record=this.getStore().getAt(e).data,this.getSelectionModel().isSelected(e)||this.getSelectionModel().selectRow(e),this.menu.removeAll();e=[];this.menu.record.menu?e=this.menu.record.menu:e.push({text:_("setting_update"),handler:this.updateSetting}),0<e.length&&(this.addContextMenuItem(e),this.menu.showAt(s.xy))},updateSetting:function(t,e){var s=this.menu.record;s.fk=Ext.isDefined(this.config.fk)?this.config.fk:0;var i=MODx.load({xtype:"modx-window-setting-update",url:CrossContextsSettings.config.connectorUrl,action:"mgr/settings/update",record:s,grid:this,listeners:{success:{fn:function(){this.refresh()},scope:this}}});i.reset(),i.setValues(s),i.show(e.target)},clearFilter:function(){var t="crosscontextssettings",e=MODx.request.area||"";this.getStore().baseParams=this.initialConfig.baseParams;var s=Ext.getCmp("modx-filter-area");s&&(s.store.baseParams.namespace=t,s.store.load(),s.reset()),Ext.getCmp("modx-filter-namespace").setValue(t),Ext.getCmp("modx-filter-key").reset(),this.getStore().baseParams.namespace=t,this.getStore().baseParams.area=e,this.getStore().baseParams.key="",this.getBottomToolbar().changePage(1)},filterByKey:function(t,e){return this.getStore().baseParams.key=e,this.getStore().baseParams.namespace="crosscontextssettings",this.getBottomToolbar().changePage(1),!0},filterByNamespace:function(){this.getStore().baseParams.namespace="crosscontextssettings",this.getStore().baseParams.area="",this.getBottomToolbar().changePage(1);var t,e=Ext.getCmp("modx-filter-area");e&&((t=e.store).baseParams.namespace="crosscontextssettings",t.removeAll(),t.load(),e.setValue(""))},listeners:{afterrender:function(){Ext.getCmp("modx-filter-namespace").hide()}}}),Ext.reg("crosscontextssettings-grid-system-settings",CrossContextsSettings.grid.SystemSettings),Ext.ns("Ext.ux.grid"),Ext.ux.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:!1,initTemplates:function(){var t=this.templates||{};t.masterTpl||(t.masterTpl=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")),this.templates=t,Ext.ux.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(t){return this.el.dom},initElements:function(){var t=Ext.get(this.grid.getGridEl().dom.firstChild),e=t.child("div.x-grid3-locked"),s=e.child("div.x-grid3-header"),i=e.child("div.x-grid3-scroller"),o=t.child("div.x-grid3-viewport"),n=o.child("div.x-grid3-header"),r=o.child("div.x-grid3-scroller");this.grid.hideHeaders&&(s.setDisplayed(!1),n.setDisplayed(!1)),this.forceFit&&r.setStyle("overflow-x","hidden"),Ext.apply(this,{el:t,mainWrap:o,mainHd:n,innerHd:n.dom.firstChild,scroller:r,mainBody:r.child("div.x-grid3-body"),focusEl:r.child("a"),resizeMarker:t.child("div.x-grid3-resize-marker"),resizeProxy:t.child("div.x-grid3-resize-proxy"),lockedWrap:e,lockedHd:s,lockedScroller:i,lockedBody:i.child("div.x-grid3-body"),lockedInnerHd:s.child("div.x-grid3-header-inner",!0)}),this.focusEl.swallowEvent("click",!0)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(t){return this.getLockedRows()[t]},getCell:function(t,e){var s=this.cm.getLockedCount();return e<s?this.getLockedRow(t).getElementsByTagName("td")[e]:Ext.ux.grid.LockingGridView.superclass.getCell.call(this,t,e-s)},getHeaderCell:function(t){var e=this.cm.getLockedCount();return t<e?this.lockedHd.dom.getElementsByTagName("td")[t]:Ext.ux.grid.LockingGridView.superclass.getHeaderCell.call(this,t-e)},addRowClass:function(t,e){var s=this.getLockedRow(t);s&&this.fly(s).addClass(e),Ext.ux.grid.LockingGridView.superclass.addRowClass.call(this,t,e)},removeRowClass:function(t,e){var s=this.getLockedRow(t);s&&this.fly(s).removeClass(e),Ext.ux.grid.LockingGridView.superclass.removeRowClass.call(this,t,e)},removeRow:function(t){Ext.removeNode(this.getLockedRow(t)),Ext.ux.grid.LockingGridView.superclass.removeRow.call(this,t)},removeRows:function(t,e){for(var s=this.lockedBody.dom,i=t;i<=e;i++)Ext.removeNode(s.childNodes[t]);Ext.ux.grid.LockingGridView.superclass.removeRows.call(this,t,e)},syncScroll:function(t){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop,Ext.ux.grid.LockingGridView.superclass.syncScroll.call(this,t)},updateSortIcon:function(t,e){var s=this.sortClasses,i=this.lockedHd.select("td").removeClass(s),o=this.mainHd.select("td").removeClass(s),n=this.cm.getLockedCount(),e=s["DESC"==e?1:0];(t<n?i.item(t):o.item(t-n)).addClass(e)},updateAllColumnWidths:function(){var t=this.getTotalWidth(),e=this.cm.getColumnCount(),s=this.getLockedWidth(),i=this.cm.getLockedCount(),o=[];for(this.updateLockedWidth(),c=0;c<e;c++)o[c]=this.getColumnWidth(c),this.getHeaderCell(c).style.width=o[c];for(var n,r,l,a=this.getLockedRows(),d=this.getRows(),c=0,h=d.length;c<h;c++){if((n=a[c]).style.width=s,n.firstChild)for(n.firstChild.style.width=s,r=n.firstChild.rows[0],l=0;l<i;l++)r.childNodes[l].style.width=o[l];if((n=d[c]).style.width=t,n.firstChild)for(n.firstChild.style.width=t,r=n.firstChild.rows[0],l=i;l<e;l++)r.childNodes[l-i].style.width=o[l]}this.onAllColumnWidthsUpdated(o,t),this.syncHeaderHeight()},updateColumnWidth:function(t,e){var s,i,o,n=this.getColumnWidth(t),r=this.cm.getLockedCount();this.updateLockedWidth();var l=t<r?(s=this.getLockedRows(),i=this.getLockedWidth(),t):(s=this.getRows(),i=this.getTotalWidth(),t-r);this.getHeaderCell(t).style.width=n;for(var a=0,d=s.length;a<d;a++)(o=s[a]).style.width=i,o.firstChild&&(o.firstChild.style.width=i,o.firstChild.rows[0].childNodes[l].style.width=n);this.onColumnWidthUpdated(t,n,this.getTotalWidth()),this.syncHeaderHeight()},updateColumnHidden:function(t,e){var s,i,o,n=this.cm.getLockedCount(),r=e?"none":"";this.updateLockedWidth();var l=t<n?(s=this.getLockedRows(),i=this.getLockedWidth(),t):(s=this.getRows(),i=this.getTotalWidth(),t-n);this.getHeaderCell(t).style.display=r;for(var a=0,d=s.length;a<d;a++)(o=s[a]).style.width=i,o.firstChild&&(o.firstChild.style.width=i,o.firstChild.rows[0].childNodes[l].style.display=r);this.onColumnHiddenUpdated(t,e,this.getTotalWidth()),delete this.lastViewWidth,this.layout()},doRender:function(t,e,s,i,o,n){for(var r,l=this.templates,a=l.cell,d=l.row,c=o-1,h="width:"+this.getTotalWidth()+";",g="width:"+this.getLockedWidth()+";",x=[],m=[],u={},p={},f=0,y=e.length;f<y;f++){for(var C=e[f],w=[],v=[],k=f+i,b=0;b<o;b++)r=t[b],u.id=r.id,u.css=(0===b?"x-grid3-cell-first ":b==c?"x-grid3-cell-last ":"")+(this.cm.config[b].cellCls?" "+this.cm.config[b].cellCls:""),u.attr=u.cellAttr="",u.value=r.renderer(C.data[r.name],u,C,k,b,s),u.style=r.style,Ext.isEmpty(u.value)&&(u.value="&#160;"),this.markDirty&&C.dirty&&Ext.isDefined(C.modified[r.name])&&(u.css+=" x-grid3-dirty-cell"),r.locked?v[v.length]=a.apply(u):w[w.length]=a.apply(u);var E=[];n&&(k+1)%2==0&&(E[0]="x-grid3-row-alt"),C.dirty&&(E[1]=" x-grid3-dirty-row"),p.cols=o,this.getRowClass&&(E[2]=this.getRowClass(C,k,p,s)),p.alt=E.join(" "),p.cells=w.join(""),p.tstyle=h,x[x.length]=d.apply(p),p.cells=v.join(""),p.tstyle=g,m[m.length]=d.apply(p)}return[x.join(""),m.join("")]},processRows:function(t,e){if(this.ds&&!(this.ds.getCount()<1)){var s,i,o=this.getRows(),n=this.getLockedRows();e=e||!this.grid.stripeRows,t=t||0;for(var r=0,l=o.length;r<l;++r)s=o[r],i=n[r],s.rowIndex=r,i.rowIndex=r,e||(s.className=s.className.replace(this.rowClsRe," "),i.className=i.className.replace(this.rowClsRe," "),(r+1)%2==0&&(s.className+=" x-grid3-row-alt",i.className+=" x-grid3-row-alt")),this.syncRowHeights(s,i);0===t&&(Ext.fly(o[0]).addClass(this.firstRowCls),Ext.fly(n[0]).addClass(this.firstRowCls)),Ext.fly(o[o.length-1]).addClass(this.lastRowCls),Ext.fly(n[n.length-1]).addClass(this.lastRowCls)}},syncRowHeights:function(t,e){var s,i;this.syncHeights&&(s=Ext.get(t),i=Ext.get(e),t=s.getHeight(),(e=i.getHeight())<t?i.setHeight(t):t<e&&s.setHeight(e))},afterRender:function(){var t;this.ds&&this.cm&&(t=this.renderRows()||["&#160;","&#160;"],this.mainBody.dom.innerHTML=t[0],this.lockedBody.dom.innerHTML=t[1],this.processRows(0,!0),!0!==this.deferEmptyText&&this.applyEmptyText(),this.grid.fireEvent("viewready",this.grid))},renderUI:function(){var t=this.templates,e=this.renderHeaders(),s=t.body.apply({rows:"&#160;"});return t.masterTpl.apply({body:s,header:e[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:s,lockedHeader:e[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var t=this.grid;this.initElements(),Ext.fly(this.innerHd).on("click",this.handleHdDown,this),Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this),this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove}),this.scroller.on("scroll",this.syncScroll,this),!1!==t.enableColumnResize&&(this.splitZone=new Ext.grid.GridView.SplitDragZone(t,this.mainHd.dom),this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom)),this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))),t.enableColumnMove&&(this.columnDrag=new Ext.grid.GridView.ColumnDragZone(t,this.innerHd),this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd)),this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd)),this.columnDrop=new Ext.grid.HeaderDropZone(t,this.mainHd.dom)),!1!==t.enableHdMenu&&(this.hmenu=new Ext.menu.Menu({id:t.id+"-hctx"}),this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"}),!1!==this.grid.enableColLock&&this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"}),!1!==t.enableColumnHide&&(this.colMenu=new Ext.menu.Menu({id:t.id+"-hcols-menu"}),this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick}),this.hmenu.add("-",{itemId:"columns",hideOnClick:!1,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})),this.hmenu.on("itemclick",this.handleHdMenuClick,this)),t.trackMouseOver&&(this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut}),this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})),(t.enableDragDrop||t.enableDrag)&&(this.dragZone=new Ext.grid.GridDragZone(t,{ddGroup:t.ddGroup||"GridDD"})),this.updateHeaderSortState()},layout:function(){var t,e,s,i;this.mainBody&&(s=(e=(t=this.grid).getGridEl().getSize(!0)).width,!t.hideHeaders&&(s<20||e.height<20)||(this.syncHeaderHeight(),t.autoHeight?(this.scroller.dom.style.overflow="visible",this.lockedScroller.dom.style.overflow="visible",Ext.isWebKit&&(this.scroller.dom.style.position="static",this.lockedScroller.dom.style.position="static")):(this.el.setSize(e.width,e.height),i=this.mainHd.getHeight(),i=e.height-i),this.updateLockedWidth(),this.forceFit?this.lastViewWidth!=s&&(this.fitColumns(!1,!1),this.lastViewWidth=s):(this.autoExpand(),this.syncHeaderScroll()),this.onLayout(s,i)))},getOffsetWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset()+"px"},renderHeaders:function(){for(var t=this.cm,e=this.templates,s=e.hcell,i=[],o=[],n={},r=t.getColumnCount(),l=r-1,a=0;a<r;a++)n.id=t.getColumnId(a),n.value=t.getColumnHeader(a)||"",n.style=this.getColumnStyle(a,!0),n.tooltip=this.getColumnTooltip(a),n.css=(0===a?"x-grid3-cell-first ":a==l?"x-grid3-cell-last ":"")+(t.config[a].headerCls?" "+t.config[a].headerCls:""),"right"==t.config[a].align?n.istyle="padding-right:16px":delete n.istyle,t.isLocked(a)?o[o.length]=s.apply(n):i[i.length]=s.apply(n);return[e.header.apply({cells:i.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),e.header.apply({cells:o.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var t=this.renderHeaders();this.innerHd.firstChild.innerHTML=t[0],this.innerHd.firstChild.style.width=this.getOffsetWidth(),this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth(),this.lockedInnerHd.firstChild.innerHTML=t[1];t=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=t,this.lockedInnerHd.firstChild.firstChild.style.width=t},getResolvedXY:function(t){if(!t)return null;var e=t.cell,t=t.row;return e?Ext.fly(e).getXY():[this.scroller.getX(),Ext.fly(t).getY()]},syncFocusEl:function(t,e,s){Ext.ux.grid.LockingGridView.superclass.syncFocusEl.call(this,t,e,!(e<this.cm.getLockedCount())&&s)},ensureVisible:function(t,e,s){return Ext.ux.grid.LockingGridView.superclass.ensureVisible.call(this,t,e,!(e<this.cm.getLockedCount())&&s)},insertRows:function(t,e,s,i){var o,n=t.getCount()-1;!i&&0===e&&n<=s?this.refresh():(i||this.fireEvent("beforerowsinserted",this,e,s),o=this.renderRows(e,s),(t=this.getRow(e))?(0===e&&this.removeRowClass(0,this.firstRowCls),Ext.DomHelper.insertHtml("beforeBegin",t,o[0]),t=this.getLockedRow(e),Ext.DomHelper.insertHtml("beforeBegin",t,o[1])):(this.removeRowClass(n-1,this.lastRowCls),Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,o[0]),Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,o[1])),i?(0===e||n<=e)&&this.addRowClass(e,0===e?this.firstRowCls:this.lastRowCls):(this.fireEvent("rowsinserted",this,e,s),this.processRows(e))),this.syncFocusEl(e)},getColumnStyle:function(t,e){e=e?this.cm.config[t].headerStyle||"":this.cm.config[t].cellStyle||this.cm.config[t].css||"";e+="width:"+this.getColumnWidth(t)+";",this.cm.isHidden(t)&&(e+="display:none;");t=this.cm.config[t].align;return t&&(e+="text-align:"+t+";"),e},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+"px"},getColumnData:function(){for(var t=[],e=this.cm,s=e.getColumnCount(),i=0;i<s;i++){var o=e.getDataIndex(i);t[i]={name:Ext.isDefined(o)?o:this.ds.fields.get(i).name,renderer:e.getRenderer(i),scope:e.getRendererScope(i),id:e.getColumnId(i),style:this.getColumnStyle(i),locked:e.isLocked(i)}}return t},renderBody:function(){var t=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:t[0]}),this.templates.body.apply({rows:t[1]})]},refreshRow:function(t){var e,s,i,o,n,r,l=this.ds,a=this.cm.getColumnCount(),d=this.getColumnData(),c=a-1,h=["x-grid3-row"],g={tstyle:String.format("width: {0};",this.getTotalWidth())},x={tstyle:String.format("width: {0};",this.getLockedWidth())},m=[],u=[],p=this.templates.cell;if(Ext.isNumber(t)?(e=t,t=l.getAt(e)):e=l.indexOf(t),t&&!(e<0)){for(r=0;r<a;r++)n=0==r?"x-grid3-cell-first":r==c?"x-grid3-cell-last ":"",(n={id:(o=d[r]).id,style:o.style,css:n,attr:"",cellAttr:""}).value=o.renderer.call(o.scope,t.data[o.name],n,t,e,r,l),Ext.isEmpty(n.value)&&(n.value=" "),this.markDirty&&t.dirty&&void 0!==t.modified[o.name]&&(n.css+=" x-grid3-dirty-cell"),o.locked?u[r]=p.apply(n):m[r]=p.apply(n);(s=this.getRow(e)).className="",(i=this.getLockedRow(e)).className="",this.grid.stripeRows&&(e+1)%2==0&&h.push("x-grid3-row-alt"),this.getRowClass&&(g.cols=a,h.push(this.getRowClass(t,e,g,l))),this.fly(s).addClass(h).setStyle(g.tstyle),g.cells=m.join(""),s.innerHTML=this.templates.rowInner.apply(g),this.fly(i).addClass(h).setStyle(x.tstyle),x.cells=u.join(""),i.innerHTML=this.templates.rowInner.apply(x),i.rowIndex=e,this.syncRowHeights(s,i),this.fireEvent("rowupdated",this,e,t)}},refresh:function(t){this.fireEvent("beforerefresh",this),this.grid.stopEditing(!0);var e=this.renderBody();this.mainBody.update(e[0]).setWidth(this.getTotalWidth()),this.lockedBody.update(e[1]).setWidth(this.getLockedWidth()),!0===t&&(this.updateHeaders(),this.updateHeaderSortState()),this.processRows(0,!0),this.layout(),this.applyEmptyText(),this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(t,e){this.cm&&this.cm.un("columnlockchange",this.onColumnLock,this),Ext.ux.grid.LockingGridView.superclass.initData.call(this,t,e),this.cm&&this.cm.on("columnlockchange",this.onColumnLock,this)},onColumnLock:function(){this.refresh(!0)},handleHdMenuClick:function(t){var e=this.hdCtxIndex,s=this.cm,i=t.getItemId(),o=s.getLockedCount();switch(i){case"lock":if(s.getColumnCount(!0)<=o+1)return void this.onDenyColumnLock();s.setLocked(e,!0,o!=e),o!=e&&(s.moveColumn(e,o),this.grid.fireEvent("columnmove",e,o));break;case"unlock":o-1!=e?(s.setLocked(e,!1,!0),s.moveColumn(e,o-1),this.grid.fireEvent("columnmove",e,o-1)):s.setLocked(e,!1);break;default:return Ext.ux.grid.LockingGridView.superclass.handleHdMenuClick.call(this,t)}return!0},handleHdDown:function(t,e){var s;Ext.ux.grid.LockingGridView.superclass.handleHdDown.call(this,t,e),!1!==this.grid.enableColLock&&Ext.fly(e).hasClass("x-grid3-hd-btn")&&(s=this.findHeaderCell(e),t=this.getCellIndex(s),e=this.hmenu.items,s=this.cm,e.get("lock").setDisabled(s.isLocked(t)),e.get("unlock").setDisabled(!s.isLocked(t)))},syncHeaderHeight:function(){var t=Ext.fly(this.innerHd).child("tr",!0),e=Ext.fly(this.lockedInnerHd).child("tr",!0);t.style.height="auto",e.style.height="auto";var s=t.offsetHeight,i=e.offsetHeight,s=Math.max(i,s)+"px";t.style.height=s,e.style.height=s},updateLockedWidth:function(){var t=this.cm.getTotalLockedWidth(),e=this.cm.getTotalWidth()-t,s=this.grid.getGridEl().getSize(!0),i=Ext.isBorderBox?0:this.lockedBorderWidth,o=Ext.isBorderBox?0:this.rowBorderWidth,n=Math.max(s.width-t-i-o,0)+"px",r=this.getScrollOffset();this.grid.autoHeight||(s=Math.max(s.height-this.mainHd.getHeight(),0)+"px",this.lockedScroller.dom.style.height=s,this.scroller.dom.style.height=s),this.lockedWrap.dom.style.width=t+o+"px",this.scroller.dom.style.width=n,this.mainWrap.dom.style.left=t+i+o+"px",this.innerHd&&(this.lockedInnerHd.firstChild.style.width=t+"px",this.lockedInnerHd.firstChild.firstChild.style.width=t+"px",this.innerHd.style.width=n,this.innerHd.firstChild.style.width=e+o+r+"px",this.innerHd.firstChild.firstChild.style.width=e+"px"),this.mainBody&&(this.lockedBody.dom.style.width=t+o+"px",this.mainBody.dom.style.width=e+o+"px")}}),Ext.ux.grid.LockingColumnModel=Ext.extend(Ext.grid.ColumnModel,{isLocked:function(t){return!0===this.config[t].locked},setLocked:function(t,e,s){this.isLocked(t)!=e&&(this.config[t].locked=e,s||this.fireEvent("columnlockchange",this,t,e))},getTotalLockedWidth:function(){for(var t=0,e=0,s=this.config.length;e<s;e++)this.isLocked(e)&&!this.isHidden(e)&&(t+=this.getColumnWidth(e));return t},getLockedCount:function(){for(var t=this.config.length,e=0;e<t;e++)if(!this.isLocked(e))return e;return t},moveColumn:function(t,e){var s=this.isLocked(t),i=this.isLocked(e);t<e&&s&&!i?this.setLocked(t,!1,!0):e<t&&!s&&i&&this.setLocked(t,!0,!0),Ext.ux.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}}),Ext.onReady(function(){MODx.load({xtype:"crosscontextssettings-page-home"})}),CrossContextsSettings.page.Home=function(t){t=t||{},Ext.applyIf(t,{components:[{xtype:"crosscontextssettings-panel-home",renderTo:"crosscontextssettings-panel-home"}]}),CrossContextsSettings.page.Home.superclass.constructor.call(this,t)},Ext.extend(CrossContextsSettings.page.Home,MODx.Component),Ext.reg("crosscontextssettings-page-home",CrossContextsSettings.page.Home);